# 마치며 - 아쉬운점 
## Bulk Insert 관련 
`[POST] /v1/coupons` API에서 디비에 넣을떄 Bulk Insert를 통해 넣었어야 했는데
Hibernate의 `IDENTITY` (데이터베이스에 자동생성 값을 위임.) 상황에서는 Bulk Insert가 자동으로 해제 된다는 점을 뒤늦게 인지함.

아래와 같은 고민을 하였음.

(1) `GenerationType.SEQUENCE`
</br>

`GenerationType.SEQUENCE`를 통한 처리를 고민하였습니다.
그러나, 일부 DBMS에서 SEQUENCE Type을 지원하지 않았고, MYSQL을 통했을떄 SEQUENCE을 사용하면 성능이 더 떨어지기 때문에 
 현재 정해진 DBMS가 없는 상황에서 판단이 어려웠습니다. 

(2) `Spring JDBC`의 batchUpdate() 사용 
</br>
- 원래는 이 방법을 통해 처리를 고민하였습니다.
이 경우에는 특정 DBMS에 의존적인 쿼리가 생성 될 수 밖에 없고 ORM을 사용하는이점 자체가 떨어진다고 생각하였습니다.

물론 서버 개발 에서 `성능` vs `예쁜 코드` 라고 이야기 한다면 `성능`을 선택하는 것이 맞습니다. <br>
하지만, 제시 받은 요구사항에서 어떤 특정 DBMS를 사용한다고 결정되지 않았기 때문에 섣불리 특정 DBMS의 쿼리로 개발하긴 힘들었습니다.

(3) 채번을 빼면 되는거 아닌가?
채번을 뺴면 되는거 아닌가? 라는 생각을 했지만, 추후 배치 관련 작업을 할때 순차증가ID는 DB의 성능을 좌우 할 수 도 있다고 생각하여 뺼 수 없었음.

## Spring Batch 관련 
추가 요구사항인 3일전에 만료 알림 주는 배치 관련되어, 
초반에 설계 당시에는  Spring Batch를 고려 하였으나 시간 분배를 잘못하면서 Spring Batch로 구성하지 못하였음.

일단 스프링 스케줄로 해결하고, 특정 서버에서 flag로 on 할 수 있게 하였는데
프로덕션 사용시, 정상적인 케이스에는 문제 없겠지만, 비정상적인 상황 (메세지 전송 서버이슈)이 발생한다면 아래의 이슈가 발생 할 수 있음.

현재 배치로 예상 되는 문제 상황
- 메세지 전송시 실패처리
- failOver
